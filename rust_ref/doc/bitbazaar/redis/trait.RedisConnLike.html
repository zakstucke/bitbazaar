<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Generic methods over the RedisConn and RedisConnOwned types."><title>RedisConnLike in bitbazaar::redis - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-46f98efaafac5295.ttf.woff2,FiraSans-Regular-018c141bf0843ffd.woff2,FiraSans-Medium-8f9a781e4970d388.woff2,SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2,SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../static.files/rustdoc-dd39b87e5fcfba68.css"><meta name="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="bitbazaar" data-themes="" data-resource-suffix="" data-rustdoc-version="1.80.0 (051478957 2024-07-21)" data-channel="1.80.0" data-search-js="search-d52510db62a78183.js" data-settings-js="settings-4313503d2e1961c2.js" ><script src="../../static.files/storage-118b08c4c78b968e.js"></script><script defer src="sidebar-items.js"></script><script defer src="../../static.files/main-20a3ad099b048cf2.js"></script><noscript><link rel="stylesheet" href="../../static.files/noscript-df360f571f6edeae.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc trait"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../bitbazaar/index.html">bitbazaar</a><span class="version">0.5.0</span></h2></div><h2 class="location"><a href="#">RedisConnLike</a></h2><div class="sidebar-elems"><section><h3><a href="#required-methods">Required Methods</a></h3><ul class="block"><li><a href="#tymethod.get_inner_conn">get_inner_conn</a></li><li><a href="#tymethod.into_owned">into_owned</a></li><li><a href="#tymethod.prefix">prefix</a></li></ul><h3><a href="#provided-methods">Provided Methods</a></h3><ul class="block"><li><a href="#method.batch">batch</a></li><li><a href="#method.cached_fn">cached_fn</a></li><li><a href="#method.dev_flushall">dev_flushall</a></li><li><a href="#method.final_key">final_key</a></li><li><a href="#method.final_namespace">final_namespace</a></li><li><a href="#method.ping">ping</a></li><li><a href="#method.rate_limiter">rate_limiter</a></li></ul><h3><a href="#object-safety">Object Safety</a></h3><h3><a href="#implementors">Implementors</a></h3></section><h2><a href="index.html">In bitbazaar::redis</a></h2></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><h1>Trait <a href="../index.html">bitbazaar</a>::<wbr><a href="index.html">redis</a>::<wbr><a class="trait" href="#">RedisConnLike</a><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><span class="out-of-band"><a class="src" href="../../src/bitbazaar/redis/conn.rs.html#81-255">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><pre class="rust item-decl"><code>pub trait RedisConnLike: <a class="trait" href="https://doc.rust-lang.org/1.80.0/core/fmt/trait.Debug.html" title="trait core::fmt::Debug">Debug</a> + <a class="trait" href="https://doc.rust-lang.org/1.80.0/core/marker/trait.Send.html" title="trait core::marker::Send">Send</a> + <a class="trait" href="https://doc.rust-lang.org/1.80.0/core/marker/trait.Sized.html" title="trait core::marker::Sized">Sized</a> {
    // Required methods
    async fn <a href="#tymethod.get_inner_conn" class="fn">get_inner_conn</a>(&amp;mut self) -&gt; <a class="enum" href="https://doc.rust-lang.org/1.80.0/core/option/enum.Option.html" title="enum core::option::Option">Option</a>&lt;&amp;mut Connection&gt;;
<span class="item-spacer"></span>    fn <a href="#tymethod.prefix" class="fn">prefix</a>(&amp;self) -&gt; &amp;<a class="primitive" href="https://doc.rust-lang.org/1.80.0/std/primitive.str.html">str</a>;
<span class="item-spacer"></span>    fn <a href="#tymethod.into_owned" class="fn">into_owned</a>(self) -&gt; RedisConnOwned;

    // Provided methods
    async fn <a href="#method.ping" class="fn">ping</a>(&amp;mut self) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.80.0/std/primitive.bool.html">bool</a> { ... }
<span class="item-spacer"></span>    async fn <a href="#method.dev_flushall" class="fn">dev_flushall</a>(&amp;mut self, sync: <a class="primitive" href="https://doc.rust-lang.org/1.80.0/std/primitive.bool.html">bool</a>) -&gt; <a class="enum" href="https://doc.rust-lang.org/1.80.0/core/option/enum.Option.html" title="enum core::option::Option">Option</a>&lt;<a class="struct" href="https://doc.rust-lang.org/1.80.0/alloc/string/struct.String.html" title="struct alloc::string::String">String</a>&gt; { ... }
<span class="item-spacer"></span>    async fn <a href="#method.rate_limiter" class="fn">rate_limiter</a>(
        &amp;mut self,
        namespace: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.80.0/std/primitive.str.html">str</a>,
        caller_identifier: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.80.0/std/primitive.str.html">str</a>,
        start_delaying_after_attempt: <a class="primitive" href="https://doc.rust-lang.org/1.80.0/std/primitive.usize.html">usize</a>,
        initial_delay: <a class="type" href="https://docs.rs/chrono/latest/chrono/type.Duration.html" title="type chrono::Duration">Duration</a>,
        multiplier: <a class="primitive" href="https://doc.rust-lang.org/1.80.0/std/primitive.f64.html">f64</a>,
    ) -&gt; <a class="enum" href="https://doc.rust-lang.org/1.80.0/core/option/enum.Option.html" title="enum core::option::Option">Option</a>&lt;<a class="type" href="https://docs.rs/chrono/latest/chrono/type.Duration.html" title="type chrono::Duration">Duration</a>&gt; { ... }
<span class="item-spacer"></span>    fn <a href="#method.batch" class="fn">batch</a>(&amp;mut self) -&gt; <a class="struct" href="struct.RedisBatch.html" title="struct bitbazaar::redis::RedisBatch">RedisBatch</a>&lt;'_, '_, Self, <a class="primitive" href="https://doc.rust-lang.org/1.80.0/std/primitive.unit.html">()</a>&gt; { ... }
<span class="item-spacer"></span>    fn <a href="#method.final_namespace" class="fn">final_namespace</a>(&amp;self, namespace: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.80.0/std/primitive.str.html">str</a>) -&gt; <a class="struct" href="https://doc.rust-lang.org/1.80.0/alloc/string/struct.String.html" title="struct alloc::string::String">String</a> { ... }
<span class="item-spacer"></span>    fn <a href="#method.final_key" class="fn">final_key</a>(&amp;self, namespace: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.80.0/std/primitive.str.html">str</a>, key: <a class="enum" href="https://doc.rust-lang.org/1.80.0/alloc/borrow/enum.Cow.html" title="enum alloc::borrow::Cow">Cow</a>&lt;'_, <a class="primitive" href="https://doc.rust-lang.org/1.80.0/std/primitive.str.html">str</a>&gt;) -&gt; <a class="struct" href="https://doc.rust-lang.org/1.80.0/alloc/string/struct.String.html" title="struct alloc::string::String">String</a> { ... }
<span class="item-spacer"></span>    async fn <a href="#method.cached_fn" class="fn">cached_fn</a>&lt;'b, T, Fut, K: <a class="trait" href="https://doc.rust-lang.org/1.80.0/core/convert/trait.Into.html" title="trait core::convert::Into">Into</a>&lt;<a class="enum" href="https://doc.rust-lang.org/1.80.0/alloc/borrow/enum.Cow.html" title="enum alloc::borrow::Cow">Cow</a>&lt;'b, <a class="primitive" href="https://doc.rust-lang.org/1.80.0/std/primitive.str.html">str</a>&gt;&gt;&gt;(
        &amp;mut self,
        namespace: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.80.0/std/primitive.str.html">str</a>,
        key: K,
        expiry: <a class="enum" href="https://doc.rust-lang.org/1.80.0/core/option/enum.Option.html" title="enum core::option::Option">Option</a>&lt;<a class="type" href="https://docs.rs/chrono/latest/chrono/type.Duration.html" title="type chrono::Duration">Duration</a>&gt;,
        cb: impl <a class="trait" href="https://doc.rust-lang.org/1.80.0/core/ops/function/trait.FnOnce.html" title="trait core::ops::function::FnOnce">FnOnce</a>() -&gt; Fut,
    ) -&gt; <a class="type" href="../errors/type.RResult.html" title="type bitbazaar::errors::RResult">RResult</a>&lt;T, <a class="struct" href="../errors/struct.AnyErr.html" title="struct bitbazaar::errors::AnyErr">AnyErr</a>&gt;
       <span class="where">where T: FromRedisValue + ToRedisArgs,
             Fut: <a class="trait" href="https://doc.rust-lang.org/1.80.0/core/future/future/trait.Future.html" title="trait core::future::future::Future">Future</a>&lt;Output = <a class="enum" href="https://doc.rust-lang.org/1.80.0/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;T, <a class="struct" href="../errors/struct.AnyErr.html" title="struct bitbazaar::errors::AnyErr">AnyErr</a>&gt;&gt;</span> { ... }
}</code></pre><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Generic methods over the RedisConn and RedisConnOwned types.</p>
</div></details><h2 id="required-methods" class="section-header">Required Methods<a href="#required-methods" class="anchor">§</a></h2><div class="methods"><details class="toggle method-toggle" open><summary><section id="tymethod.get_inner_conn" class="method"><a class="src rightside" href="../../src/bitbazaar/redis/conn.rs.html#85">source</a><h4 class="code-header">async fn <a href="#tymethod.get_inner_conn" class="fn">get_inner_conn</a>(&amp;mut self) -&gt; <a class="enum" href="https://doc.rust-lang.org/1.80.0/core/option/enum.Option.html" title="enum core::option::Option">Option</a>&lt;&amp;mut Connection&gt;</h4></section></summary><div class="docblock"><p>Get an internal connection from the pool, connections are kept in the pool for reuse.
If redis is acting up and unavailable, this will return None.
NOTE: this mainly is used internally, but provides a fallback to the underlying connection, if the exposed interface does not provide options that fit an external user need (which could definitely happen).</p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.prefix" class="method"><a class="src rightside" href="../../src/bitbazaar/redis/conn.rs.html#88">source</a><h4 class="code-header">fn <a href="#tymethod.prefix" class="fn">prefix</a>(&amp;self) -&gt; &amp;<a class="primitive" href="https://doc.rust-lang.org/1.80.0/std/primitive.str.html">str</a></h4></section></summary><div class="docblock"><p>Get the redis configured prefix.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.into_owned" class="method"><a class="src rightside" href="../../src/bitbazaar/redis/conn.rs.html#91">source</a><h4 class="code-header">fn <a href="#tymethod.into_owned" class="fn">into_owned</a>(self) -&gt; RedisConnOwned</h4></section></summary><div class="docblock"><p>Convert to the owned variant.</p>
</div></details></div><h2 id="provided-methods" class="section-header">Provided Methods<a href="#provided-methods" class="anchor">§</a></h2><div class="methods"><details class="toggle method-toggle" open><summary><section id="method.ping" class="method"><a class="src rightside" href="../../src/bitbazaar/redis/conn.rs.html#94-103">source</a><h4 class="code-header">async fn <a href="#method.ping" class="fn">ping</a>(&amp;mut self) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.80.0/std/primitive.bool.html">bool</a></h4></section></summary><div class="docblock"><p>Ping redis, returning true if it’s up.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.dev_flushall" class="method"><a class="src rightside" href="../../src/bitbazaar/redis/conn.rs.html#132-150">source</a><h4 class="code-header">async fn <a href="#method.dev_flushall" class="fn">dev_flushall</a>(&amp;mut self, sync: <a class="primitive" href="https://doc.rust-lang.org/1.80.0/std/primitive.bool.html">bool</a>) -&gt; <a class="enum" href="https://doc.rust-lang.org/1.80.0/core/option/enum.Option.html" title="enum core::option::Option">Option</a>&lt;<a class="struct" href="https://doc.rust-lang.org/1.80.0/alloc/string/struct.String.html" title="struct alloc::string::String">String</a>&gt;</h4></section></summary><div class="docblock"><p>Flush the whole redis cache, will delete all data.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.rate_limiter" class="method"><a class="src rightside" href="../../src/bitbazaar/redis/conn.rs.html#167-201">source</a><h4 class="code-header">async fn <a href="#method.rate_limiter" class="fn">rate_limiter</a>(
    &amp;mut self,
    namespace: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.80.0/std/primitive.str.html">str</a>,
    caller_identifier: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.80.0/std/primitive.str.html">str</a>,
    start_delaying_after_attempt: <a class="primitive" href="https://doc.rust-lang.org/1.80.0/std/primitive.usize.html">usize</a>,
    initial_delay: <a class="type" href="https://docs.rs/chrono/latest/chrono/type.Duration.html" title="type chrono::Duration">Duration</a>,
    multiplier: <a class="primitive" href="https://doc.rust-lang.org/1.80.0/std/primitive.f64.html">f64</a>,
) -&gt; <a class="enum" href="https://doc.rust-lang.org/1.80.0/core/option/enum.Option.html" title="enum core::option::Option">Option</a>&lt;<a class="type" href="https://docs.rs/chrono/latest/chrono/type.Duration.html" title="type chrono::Duration">Duration</a>&gt;</h4></section></summary><div class="docblock"><p>A simple rate_limiter/backoff helper.
Can be used to protect against repeated attempts in quick succession.
Once <code>start_delaying_after_attempt</code> is hit, the operation delay will multiplied by the multiplier each time.
Only once no call is made for the duration of the current delay (so current delay doubled) will the attempt number reset to zero.</p>
<p>Arguments:</p>
<ul>
<li><code>namespace</code>: A unique identifier for the endpoint, e.g. user-login.</li>
<li><code>caller_identifier</code>: A unique identifier for the caller, e.g. a user id.</li>
<li><code>start_delaying_after_attempt</code>: The number of attempts before the delays start being imposed.</li>
<li><code>initial_delay</code>: The initial delay to impose.</li>
<li><code>multiplier</code>: The multiplier to apply, <code>(attempt-start_delaying_after_attempt) * multiplier * initial_delay = delay</code>.</li>
</ul>
<p>Returns:</p>
<ul>
<li><code>None</code>: Continue with the operation.</li>
<li><code>Some&lt;chrono::Duration&gt;</code>: Retry after the duration.</li>
</ul>
</div></details><details class="toggle method-toggle" open><summary><section id="method.batch" class="method"><a class="src rightside" href="../../src/bitbazaar/redis/conn.rs.html#204-206">source</a><h4 class="code-header">fn <a href="#method.batch" class="fn">batch</a>(&amp;mut self) -&gt; <a class="struct" href="struct.RedisBatch.html" title="struct bitbazaar::redis::RedisBatch">RedisBatch</a>&lt;'_, '_, Self, <a class="primitive" href="https://doc.rust-lang.org/1.80.0/std/primitive.unit.html">()</a>&gt;</h4></section></summary><div class="docblock"><p>Get a new <a href="struct.RedisBatch.html" title="struct bitbazaar::redis::RedisBatch"><code>RedisBatch</code></a> for this connection that commands can be piped together with.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.final_namespace" class="method"><a class="src rightside" href="../../src/bitbazaar/redis/conn.rs.html#210-212">source</a><h4 class="code-header">fn <a href="#method.final_namespace" class="fn">final_namespace</a>(&amp;self, namespace: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.80.0/std/primitive.str.html">str</a>) -&gt; <a class="struct" href="https://doc.rust-lang.org/1.80.0/alloc/string/struct.String.html" title="struct alloc::string::String">String</a></h4></section></summary><div class="docblock"><p>Redis keys are all prefixed, use this to finalise a namespace outside of built in commands, e.g. for use in a custom script.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.final_key" class="method"><a class="src rightside" href="../../src/bitbazaar/redis/conn.rs.html#216-218">source</a><h4 class="code-header">fn <a href="#method.final_key" class="fn">final_key</a>(&amp;self, namespace: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.80.0/std/primitive.str.html">str</a>, key: <a class="enum" href="https://doc.rust-lang.org/1.80.0/alloc/borrow/enum.Cow.html" title="enum alloc::borrow::Cow">Cow</a>&lt;'_, <a class="primitive" href="https://doc.rust-lang.org/1.80.0/std/primitive.str.html">str</a>&gt;) -&gt; <a class="struct" href="https://doc.rust-lang.org/1.80.0/alloc/string/struct.String.html" title="struct alloc::string::String">String</a></h4></section></summary><div class="docblock"><p>Redis keys are all prefixed, use this to finalise a key outside of built in commands, e.g. for use in a custom script.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.cached_fn" class="method"><a class="src rightside" href="../../src/bitbazaar/redis/conn.rs.html#228-254">source</a><h4 class="code-header">async fn <a href="#method.cached_fn" class="fn">cached_fn</a>&lt;'b, T, Fut, K: <a class="trait" href="https://doc.rust-lang.org/1.80.0/core/convert/trait.Into.html" title="trait core::convert::Into">Into</a>&lt;<a class="enum" href="https://doc.rust-lang.org/1.80.0/alloc/borrow/enum.Cow.html" title="enum alloc::borrow::Cow">Cow</a>&lt;'b, <a class="primitive" href="https://doc.rust-lang.org/1.80.0/std/primitive.str.html">str</a>&gt;&gt;&gt;(
    &amp;mut self,
    namespace: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.80.0/std/primitive.str.html">str</a>,
    key: K,
    expiry: <a class="enum" href="https://doc.rust-lang.org/1.80.0/core/option/enum.Option.html" title="enum core::option::Option">Option</a>&lt;<a class="type" href="https://docs.rs/chrono/latest/chrono/type.Duration.html" title="type chrono::Duration">Duration</a>&gt;,
    cb: impl <a class="trait" href="https://doc.rust-lang.org/1.80.0/core/ops/function/trait.FnOnce.html" title="trait core::ops::function::FnOnce">FnOnce</a>() -&gt; Fut,
) -&gt; <a class="type" href="../errors/type.RResult.html" title="type bitbazaar::errors::RResult">RResult</a>&lt;T, <a class="struct" href="../errors/struct.AnyErr.html" title="struct bitbazaar::errors::AnyErr">AnyErr</a>&gt;<div class="where">where
    T: FromRedisValue + ToRedisArgs,
    Fut: <a class="trait" href="https://doc.rust-lang.org/1.80.0/core/future/future/trait.Future.html" title="trait core::future::future::Future">Future</a>&lt;Output = <a class="enum" href="https://doc.rust-lang.org/1.80.0/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;T, <a class="struct" href="../errors/struct.AnyErr.html" title="struct bitbazaar::errors::AnyErr">AnyErr</a>&gt;&gt;,</div></h4></section></summary><div class="docblock"><p>Cache an async function in redis with an optional expiry.
If already stored, the cached value will be returned, otherwise the function will be stored in redis for next time.</p>
<p>If redis is unavailable, or the existing contents at the key is wrong, the function output will be used.
The only error coming out of here should be something wrong with the external callback.</p>
<p>Expiry accurate to a millisecond.</p>
</div></details></div><h2 id="object-safety" class="section-header">Object Safety<a href="#object-safety" class="anchor">§</a></h2><div class="object-safety-info">This trait is <b>not</b> <a href="https://doc.rust-lang.org/1.80.0/reference/items/traits.html#object-safety">object safe</a>.</div><h2 id="implementors" class="section-header">Implementors<a href="#implementors" class="anchor">§</a></h2><div id="implementors-list"><section id="impl-RedisConnLike-for-RedisConn%3C'a%3E" class="impl"><a class="src rightside" href="../../src/bitbazaar/redis/conn.rs.html#257-282">source</a><a href="#impl-RedisConnLike-for-RedisConn%3C'a%3E" class="anchor">§</a><h3 class="code-header">impl&lt;'a&gt; <a class="trait" href="trait.RedisConnLike.html" title="trait bitbazaar::redis::RedisConnLike">RedisConnLike</a> for <a class="struct" href="struct.RedisConn.html" title="struct bitbazaar::redis::RedisConn">RedisConn</a>&lt;'a&gt;</h3></section></div><script src="../../trait.impl/bitbazaar/redis/conn/trait.RedisConnLike.js" async></script></section></div></main></body></html>